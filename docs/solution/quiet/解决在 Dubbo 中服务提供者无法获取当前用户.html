<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-solution/quiet/è§£å†³åœ¨ Dubbo ä¸­æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">è§£å†³æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ· | lin-mt</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lin-mt.github.io/wiki/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lin-mt.github.io/wiki/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lin-mt.github.io/wiki/docs/solution/quiet/è§£å†³åœ¨ Dubbo ä¸­æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="è§£å†³æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ· | lin-mt"><meta data-rh="true" name="description" content="é—®é¢˜èµ·æº"><meta data-rh="true" property="og:description" content="é—®é¢˜èµ·æº"><link data-rh="true" rel="icon" href="/wiki/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lin-mt.github.io/wiki/docs/solution/quiet/è§£å†³åœ¨ Dubbo ä¸­æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·"><link data-rh="true" rel="alternate" href="https://lin-mt.github.io/wiki/docs/solution/quiet/è§£å†³åœ¨ Dubbo ä¸­æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lin-mt.github.io/wiki/docs/solution/quiet/è§£å†³åœ¨ Dubbo ä¸­æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SM4ZQXO5BK-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/wiki/blog/rss.xml" title="lin-mt RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/wiki/blog/atom.xml" title="lin-mt Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="lin-mt" href="/wiki/opensearch.xml"><link rel="stylesheet" href="/wiki/assets/css/styles.6a4c2e1d.css">
<link rel="preload" href="/wiki/assets/js/runtime~main.af64cee5.js" as="script">
<link rel="preload" href="/wiki/assets/js/main.6560775e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="è·³åˆ°ä¸»è¦å†…å®¹"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">è·³åˆ°ä¸»è¦å†…å®¹</a></div><nav aria-label="ä¸»å¯¼èˆª" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="åˆ‡æ¢å¯¼èˆªæ " aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/wiki/"><div class="navbar__logo"><img src="/wiki/img/logo.svg" alt="lin-mt" class="themedImage_ToTc themedImage--light_HNdA"><img src="/wiki/img/logo.svg" alt="lin-mt" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">lin-mt</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ğŸ¤« Quiet</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/wiki/docs/quiet/document">ğŸ“„ æ–‡æ¡£</a></li><li><a class="dropdown__link" href="/wiki/docs/quiet/plugins/gradle">ğŸ§° æ’ä»¶</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ğŸ”§ è§£å†³æ–¹æ¡ˆ</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/wiki/docs/solution/quiet/è§£å†³åœ¨ Dubbo ä¸­æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·">ğŸ¤« Quiet</a></li></ul></div><a class="navbar__item navbar__link" href="/wiki/blog">ğŸ“•åšå®¢</a><a href="https://github.com/lin-mt/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="å›åˆ°é¡¶éƒ¨" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="æ–‡æ¡£ä¾§è¾¹æ " class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/wiki/docs/solution/quiet/è§£å†³åœ¨ Dubbo ä¸­æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·">è§£å†³æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="é¡µé¢è·¯å¾„"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ä¸»é¡µé¢" class="breadcrumbs__link" href="/wiki/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">è§£å†³æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><h1>è§£å†³æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="é—®é¢˜èµ·æº">é—®é¢˜èµ·æº<a href="#é—®é¢˜èµ·æº" class="hash-link" aria-label="é—®é¢˜èµ·æºçš„ç›´æ¥é“¾æ¥" title="é—®é¢˜èµ·æºçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Quiet é¡¹ç›®ä¸­ä½¿ç”¨äº† Dubbo å®ç°æœåŠ¡é—´è°ƒç”¨ï¼Œä½¿ç”¨ Spring Security Oauth2 å®ç°æˆæƒå’Œé‰´æƒã€‚</p><p>é‚£ä¹ˆå°±ä¼šæœ‰ä¸ªé—®é¢˜ï¼šåœ¨æœåŠ¡æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æä¾›è€…çš„æ—¶å€™ï¼ŒæœåŠ¡æä¾›è€…æ— æ³•é€šè¿‡ <code>SecurityContextHolder.getContext().getAuthentication()</code> è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ<a href="#é—®é¢˜åˆ†æ" class="hash-link" aria-label="é—®é¢˜åˆ†æçš„ç›´æ¥é“¾æ¥" title="é—®é¢˜åˆ†æçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è¨€å½’æ­£ä¼ ï¼Œä¸ºå•¥ä½¿ç”¨ Dubbo è°ƒç”¨æ—¶ï¼ŒæœåŠ¡æä¾›è€…æ— æ³•é€šè¿‡ <code>SecurityContextHolder.getContext().getAuthentication()</code> è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œè¦ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œå…ˆææ˜ç™½è·å–çš„è¿‡ç¨‹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹">è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹<a href="#è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹" class="hash-link" aria-label="è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹çš„ç›´æ¥é“¾æ¥" title="è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ–¹æ³• <code>SecurityContextHolder.getContext().getAuthentication()</code> æ˜¯é€šè¿‡è°ƒç”¨ <code>SecurityContextHolder</code> é‡Œé¢çš„ <code>strategy</code> å±æ€§çš„ <code>getContext</code> æ–¹æ³•è·å– <code>SecurityContext</code> å®ä¾‹ï¼Œç„¶åå†é€šè¿‡ <code>SecurityContext</code> çš„ <code>getAuthentication</code> è·å–ç”¨æˆ·ä¿¡æ¯çš„ã€‚</p><p><code>SecurityContextHolderStrategy</code> æ˜¯ä¸€ä¸ªæ¥å£ç±»ï¼Œå®ƒçš„å®ç°ç±»å¦‚ä¸‹ï¼š</p><img loading="lazy" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78b2cf1e2d83429b83523c03444ec693~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" width="50%" class="img_ev3q"><p>å®ƒä¸€å…±æœ‰å››ç§å®ç°ç±»ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨ä¸­ï¼Œå®ƒä½¿ç”¨çš„æ˜¯å“ªä¸€ç§å®ç°ç±»ï¼Œå…ˆçœ‹ä¸‹ <code>SecurityContextHolder</code>ã€‚</p><p><code>SecurityContextHolder</code> æ˜¯å°†ç»™å®šçš„ <code>SecurityContext</code> ä¸å½“å‰æ‰§è¡Œçº¿ç¨‹å…³è”èµ·æ¥ï¼Œè·å–å’Œè®¾ç½® <code>SecurityContext</code> çš„æ–¹å¼æ˜¯å§”æ‰˜ç»™ <code>strategy</code> å±æ€§ï¼Œè¯»ä¸€ä¸‹ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 1. é¦–å…ˆä¼šè·å– JVM çš„ spring.security.strategy å±æ€§</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 2. åœ¨ç±»åŠ è½½çš„æ—¶å€™ä¼šè°ƒç”¨ä¸€æ¬¡ initialize æ–¹æ³•ï¼Œè¿›è¡Œåˆå§‹åŒ–</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 3. æ ¹æ® spring.security.strategy å±æ€§ï¼Œé‡‡ç”¨ä¸åŒçš„å®ç°ç±»åˆå§‹åŒ– strategy å±æ€§</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 4. å¦‚æœæ²¡æœ‰è®¾ç½® spring.security.strategy å±æ€§ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ MODE_THREADLOCAL ç­–ç•¥</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 5. MODE_THREADLOCAL ç­–ç•¥ï¼Œstrategy åˆ™æ˜¯ä½¿ç”¨ ThreadLocalSecurityContextHolderStrategy è¿›è¡Œåˆå§‹åŒ–</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> **/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SYSTEM_PROPERTY</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;spring.security.strategy&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> strategyName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">SYSTEM_PROPERTY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">initializeStrategy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// åˆå§‹åŒ–æ¬¡æ•° +1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> initializeCount</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initializeStrategy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">MODE_PRE_INITIALIZED</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategyName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">Assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">state</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategy </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;When using &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MODE_PRE_INITIALIZED</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;, setContextHolderStrategy must be called with the fully constructed strategy&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token class-name">StringUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategyName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Set default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  strategyName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MODE_THREADLOCAL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategyName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">MODE_THREADLOCAL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  strategy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ThreadLocalSecurityContextHolderStrategy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategyName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">MODE_INHERITABLETHREADLOCAL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  strategy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">InheritableThreadLocalSecurityContextHolderStrategy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategyName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">MODE_GLOBAL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  strategy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">GlobalSecurityContextHolderStrategy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Try to load a custom strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®ç°ç­–ç•¥ï¼Œæ‰©å±•æ€§+++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">Class</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> clazz </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Class</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategyName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">Constructor</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> customStrategy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clazz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getConstructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  strategy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SecurityContextHolderStrategy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> customStrategy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Exception</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">ReflectionUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">handleReflectionException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>çœ‹ä¸‹ <code>ThreadLocalSecurityContextHolderStrategy</code> ç±»ï¼Œå¯ä»¥å‘ç°è¿™ä¸ªç±»æ˜¯é€šè¿‡ä¸€ä¸ª <code>ThreadLocal</code> å±æ€§å­˜å‚¨å’Œè·å– <code>SecurityContext</code>:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">ThreadLocal</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">SecurityContext</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> contextHolder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ThreadLocal</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å†çœ‹çœ‹æ¥å£ <code>SecurityContextHolderStrategy</code>ï¼Œå¯ä»¥å‘ç°å®ƒæä¾›äº† <code>setContext</code> æ–¹æ³•æ¥è®¾ç½® <code>SecurityContext</code>ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ <code>SecurityContextHolder.getContext().getAuthentication()</code> è·å–çš„ <code>SecurityContext</code> å°±æ˜¯é€šè¿‡ <code>setContext</code> æ–¹æ³•è®¾ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šå…¶ä»–ç­–ç•¥çš„è¯ï¼Œä¹Ÿå°±æ˜¯ <code>org.springframework.security.core.context.ThreadLocalSecurityContextHolderStrategy#contextHolder</code> å­˜å‚¨çš„å€¼ï¼Œçœ‹ä¸‹ <code>SecurityContext</code> çš„å®ç°ç±»ï¼Œå¯ä»¥å‘ç°ç”¨æˆ·ä¿¡æ¯æ˜¯é€šè¿‡ <code>org.springframework.security.core.context.SecurityContextImpl#getAuthentication</code> æ–¹æ³•è·å–çš„ï¼Œè€Œè·å–çš„ç”¨æˆ·ä¿¡æ¯æ˜¯ <code>SecurityContext</code> ä½¿ç”¨æ–¹æ³• <code>setAuthentication</code> è®¾ç½®çš„ï¼Œè®¾ç½®çš„ç”¨æˆ·ä¿¡æ¯åˆæ˜¯ä»å“ªæ¥çš„å‘¢ï¼Ÿ</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="securitycontext-çš„-authentication-æ˜¯ä»å“ªæ¥çš„"><code>SecurityContext</code> çš„ <code>authentication</code> æ˜¯ä»å“ªæ¥çš„<a href="#securitycontext-çš„-authentication-æ˜¯ä»å“ªæ¥çš„" class="hash-link" aria-label="securitycontext-çš„-authentication-æ˜¯ä»å“ªæ¥çš„çš„ç›´æ¥é“¾æ¥" title="securitycontext-çš„-authentication-æ˜¯ä»å“ªæ¥çš„çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ä¸Šé¢çš„åˆ†æä¸­ï¼ŒçŸ¥é“äº† Spring Security æ˜¯å¦‚ä½•è®¾ç½®çš„ <code>authentication</code>ï¼Œé‚£ä¹ˆå°±åœ¨è®¾ç½®çš„åœ°æ–¹æ‰“ä¸ªæ–­ç‚¹ DEBUG ä¸‹ï¼š</p><p><img loading="lazy" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f571534b8df643e39f34d91ef202f441~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" class="img_ev3q"></p><p>å†è·Ÿè¸ªä¸‹å®ƒçš„å †æ ˆä¿¡æ¯ï¼š</p><p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b2cc369256a4610b8d7a8f2484d65ba~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" class="img_ev3q"></p><p>åœ¨æ­¤å¯ä»¥å‘ç°ç”¨æˆ·ä¿¡æ¯æ˜¯åœ¨æ–¹æ³•ï¼š<code>org.springframework.security.oauth2.provider.authentication.OAuth2AuthenticationProcessingFilter#doFilter</code> ä¸­è·å–å’Œè®¾ç½®çš„ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå…³é”®åœ¨äºè¿™æ®µä»£ç ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">Authentication</span><span class="token plain"> authResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> authenticationManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">authenticate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">authentication</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿™æ®µä»£ç éªŒè¯å¹¶è·å–äº†ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨åˆ†æè¿™æ®µä»£ç ä¹‹å‰ï¼Œå¯ä»¥å…ˆç•™æ„ä¸‹è¿™ä¸ªæ–¹æ³•ä¸­çš„è¿™æ®µä»£ç ï¼Œåé¢æœ‰ç”¨ï¼š<code>request.setAttribute(OAuth2AuthenticationDetails.ACCESS_TOKEN_VALUE, authentication.getPrincipal());</code>ã€‚</p><p>åœ¨ <code>authenticationManager.authenticate</code> æ‰“ä¸ªæ–­ç‚¹ï¼Œè·Ÿè¸ªä¸‹å»ï¼Œå¯ä»¥å‘ç°åœ¨æ–¹æ³• <code>org.springframework.security.oauth2.provider.authentication.OAuth2AuthenticationManager#authenticate</code> ä¸­è·å–äº†ç”¨æˆ·ä¿¡æ¯ï¼š</p><p><img loading="lazy" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d12441fe2e9242ee93ee04df7c79dc99~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" class="img_ev3q"></p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œå°±å¯ä»¥ææ¸…æ¥šæ˜¯æ€ä¹ˆè·å–ç”¨æˆ·ä¿¡æ¯çš„äº†ï¼Œä» <code>authentication.getPrincipal()</code> è·å– tokenï¼Œå†é€šè¿‡ token åˆ° <code>tokenServices</code> è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè‡³äº <code>tokenServices</code> æ˜¯æ€ä¹ˆè·å–ç”¨æˆ·ä¿¡æ¯çš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±æ·±ç©¶ï¼Œè¿™é‡Œç®€å•è¯´ä¸‹ï¼Œ<code>tokenServices</code> æ˜¯é€šè¿‡ä¸€ä¸ª <code>tokenStore</code> å’Œ token è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸ª <code>tokenStore</code> æ˜¯åœ¨æˆ‘ä»¬æ•´åˆ Spring Security Oauth2 æ—¶æ³¨å…¥çš„ä¸€ä¸ª Beanï¼Œè¿™ä¸ª Bean å¯ä»¥ç”¨æ¥å­˜å‚¨å’Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå…·ä½“çš„å®ç°æ–¹å¼å¯ä»¥è‡ªå·±å®ç°æ¥å£ <code>org.springframework.security.oauth2.provider.token.TokenStore</code> è¿›è¡Œæ‰©å±•ï¼Œå½“ç„¶ <code>tokenServices</code> ä¹Ÿå¯ä»¥è‡ªå·±å®ç°ã€‚</p><p>è¿˜è®°å¾—ä¸Šé¢ç•™æ„çš„é‚£æ®µä»£ç å—ï¼ŸSpring Security Oauth2 å…¶å®å·²ç»æŠŠè¿™ä¸ª token è®¾ç½®åˆ° request çš„å±æ€§ä¸­äº†ã€‚</p><p>ç°åœ¨æˆ‘ä»¬ææ˜ç™½äº†æ–¹æ³• <code>SecurityContextHolder.getContext().getAuthentication()</code> è·å–ç”¨æˆ·ä¿¡æ¯çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå¹¶ä¸”åœ¨ Dubbo è°ƒç”¨çš„æ—¶å€™ï¼ŒæœåŠ¡æä¾›è€…æ— æ³•é€šè¿‡è¯¥æ–¹æ³•è·å–ç”¨æˆ·ä¿¡æ¯çš„åŸå› ï¼Œè¿™ç¯‡æˆ‘ä»¬å°±è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ<a href="#è§£å†³æ–¹æ¡ˆ" class="hash-link" aria-label="è§£å†³æ–¹æ¡ˆçš„ç›´æ¥é“¾æ¥" title="è§£å†³æ–¹æ¡ˆçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æ—¢ç„¶ç”¨çš„æ˜¯ Dubbo å‘èµ·çš„è¯·æ±‚ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥åœ¨å‘èµ·è¯·æ±‚å’Œå—ç†è¯·æ±‚çš„æ—¶å€™ï¼Œå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œåƒè¿™ç§å¼€æºé¡¹ç›®ï¼Œå…¶æä¾›çš„æ‰©å±•ç‚¹æ˜¯å¾ˆå¤šçš„ï¼Œåœ¨ Dubbo ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ <a href="https://dubbo.apache.org/zh/docs3-v2/java-sdk/concepts-and-architecture/service-invocation/#filter%E6%8B%A6%E6%88%AA%E5%99%A8" target="_blank" rel="noopener noreferrer">è‡ªå®šä¹‰ Filter</a> åœ¨æœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…ä¹‹é—´å®ç°æ•°æ®çš„æ·»åŠ å’Œè·å–ï¼Œå…¶åŸç†ç±»ä¼¼ Java SPIã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ–¹æ¡ˆä¸€ä¼ é€’ç”¨æˆ·ä¿¡æ¯">æ–¹æ¡ˆä¸€ï¼šä¼ é€’ç”¨æˆ·ä¿¡æ¯<a href="#æ–¹æ¡ˆä¸€ä¼ é€’ç”¨æˆ·ä¿¡æ¯" class="hash-link" aria-label="æ–¹æ¡ˆä¸€ï¼šä¼ é€’ç”¨æˆ·ä¿¡æ¯çš„ç›´æ¥é“¾æ¥" title="æ–¹æ¡ˆä¸€ï¼šä¼ é€’ç”¨æˆ·ä¿¡æ¯çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ—¢ç„¶æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨çš„æ—¶å€™æŠŠæ•´ä¸ªç”¨æˆ·ä¿¡æ¯éƒ½ä¼ é€’è¿‡å»ï¼Œç„¶åå†è®¾ç½®åˆ° <code>SecurityContext</code> ä¸­ï¼Œè¿™æ ·æœåŠ¡æä¾›è€…å°±èƒ½è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯äº†ã€‚è¿™ä¸ªæ–¹æ¡ˆæ˜¯å¯ä»¥è§£å†³é—®é¢˜çš„ï¼Œä½†æ˜¯éå¸¸ä¸å¥½ï¼Œå› ä¸ºæ¯ä¸ªç”¨æˆ·çš„ç”¨æˆ·ä¿¡æ¯æ•°æ®é‡æ˜¯ä¸å›ºå®šçš„ï¼Œæ¯ä¸ªç”¨æˆ·æ‹¥æœ‰çš„æƒé™ã€è§’è‰²ç­‰ä¿¡æ¯éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¼ é€’çš„æ•°æ®é‡ä¸å¯æ§ï¼Œè€Œä¸”ä¼šæ¶ˆè€—å¤§é‡çš„ç½‘ç»œèµ„æºã€‚ä½¿ç”¨è¿™ç§æ–¹æ¡ˆè¿˜éœ€è¦è§£å†³åºåˆ—åŒ–çš„é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¸æ˜¯æœ€ä½³çš„ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ–¹æ¡ˆäºŒè‡ªå·±å®šä¹‰ä¸€ä¸ª-keyå°†ç”¨æˆ·ä¿¡æ¯å­˜åˆ°-redis">æ–¹æ¡ˆäºŒï¼šè‡ªå·±å®šä¹‰ä¸€ä¸ª keyï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜åˆ° Redis<a href="#æ–¹æ¡ˆäºŒè‡ªå·±å®šä¹‰ä¸€ä¸ª-keyå°†ç”¨æˆ·ä¿¡æ¯å­˜åˆ°-redis" class="hash-link" aria-label="æ–¹æ¡ˆäºŒï¼šè‡ªå·±å®šä¹‰ä¸€ä¸ª keyï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜åˆ° Redisçš„ç›´æ¥é“¾æ¥" title="æ–¹æ¡ˆäºŒï¼šè‡ªå·±å®šä¹‰ä¸€ä¸ª keyï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜åˆ° Redisçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨æœåŠ¡æ¶ˆè´¹è€…å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œè‡ªå·±å®šä¹‰ä¸€ä¸ª Redis keyï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ° Redisï¼Œç„¶åå†å°†è¿™ä¸ª key ä¼ é€’ç»™æœåŠ¡æä¾›è€…ï¼ŒæœåŠ¡æä¾›è€…å†å» Redis è·å–ç”¨æˆ·ä¿¡æ¯ã€‚è¿™ä¸ªæ–¹æ¡ˆæ˜¯ä¸Šç¯‡é‡åˆ°çš„é‚£ä¸ªé¢è¯•å®˜æå‡ºçš„ï¼Œé¢è¯•çš„æ—¶å€™æ²¡ä»”ç»†æƒ³è¿™ä¸ªæ–¹æ¡ˆçš„å¥½åï¼Œç­‰é¢è¯•ç»“æŸçš„æ—¶å€™å‘ç°è¿™ä¸ªæ–¹æ¡ˆè¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚</p><p>é¦–å…ˆå‘¢ï¼ŒRedis å·²ç»å­˜æœ‰ä¸€ä»½ç”¨æˆ·ä¿¡æ¯äº†ï¼Œå†å­˜ä¸€ä»½ï¼Œå±å®æ²¡å¿…è¦ï¼Œè€Œä¸”è¿˜éœ€è¦ç»´æŠ¤ä¸¤ä»½ç”¨æˆ·ä¿¡æ¯ï¼Œä¿æŒä¸¤ä»½ç”¨æˆ·ä¿¡æ¯çš„ä¸€è‡´ã€‚å†è€…ï¼Œè¿™ä¸ª Redis key çš„è¿‡æœŸæ—¶é—´è¦æ€ä¹ˆè®¾ç½®ï¼Ÿè®¾ç½®ä¸€ä¸ªå›ºå®šçš„æ—¶é—´å—ï¼Ÿè¿™ä¸ªæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºåœ¨æ•´ä¸ªç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ token è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœè‡ªå®šä¹‰çš„ Redis key æ—¶é—´æ˜¯å›ºå®šçš„ï¼Œå°±ä¼šå‡ºç° token å·²ç»è¿‡æœŸï¼Œä½†æ˜¯æœåŠ¡æä¾›è€…æ— æ³•çŸ¥æ™“å½“å‰ç”¨æˆ·å·²ç»è¿‡æœŸï¼Œå› ä¸ºåœ¨ Redis key è¿˜æœªè¿‡æœŸçš„æ—¶å€™å®ƒä»ç„¶èƒ½è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™å·²ç»ç ´åäº†ç³»ç»Ÿçš„æ•´ä½“æ€§ï¼Œé‚£ä¹ˆå°±å¾—åŠ¨æ€å»è®¡ç®—è¿™ä¸ª Redis key çš„è¿‡æœŸæ—¶é—´ï¼Œå±å±±å°±æ˜¯è¿™ä¹ˆå †èµ·æ¥çš„ï½</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ–¹æ¡ˆä¸‰ç›´æ¥ä½¿ç”¨-token">æ–¹æ¡ˆä¸‰ï¼šç›´æ¥ä½¿ç”¨ token<a href="#æ–¹æ¡ˆä¸‰ç›´æ¥ä½¿ç”¨-token" class="hash-link" aria-label="æ–¹æ¡ˆä¸‰ï¼šç›´æ¥ä½¿ç”¨ tokençš„ç›´æ¥é“¾æ¥" title="æ–¹æ¡ˆä¸‰ï¼šç›´æ¥ä½¿ç”¨ tokençš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ç›´æ¥ä½¿ç”¨ tokenï¼ŒæœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…ä»¥åŠæ•´ä¸ªç³»ç»Ÿéƒ½å…±ç”¨ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ï¼Œæ–¹æ¡ˆä¸€å’Œæ–¹æ¡ˆäºŒçš„æ‰€æœ‰é—®é¢˜ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚åœ¨ä¸Šç¯‡ä¸­æˆ‘ä»¬å·²ç»çŸ¥æ™“å¦‚ä½•é€šè¿‡ä¸€ä¸ª token è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä» request ä¸­è·å–å¹¶ç›´æ¥ä¼ é€’ tokenï¼Œåœ¨æœåŠ¡æä¾›è€…å¤„<strong>å¤ç°è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹</strong>ã€‚åŒæ—¶ï¼ŒæœåŠ¡æä¾›è€…<strong>ä»€ä¹ˆæ—¶å€™è·å–ç”¨æˆ·ä¿¡æ¯</strong>ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæœåŠ¡æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æä¾›è€…çš„æ¥å£æ—¶ï¼ŒæœåŠ¡æä¾›è€…å¹¶ä¸ä¸€å®šéœ€è¦å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœåœ¨è¯·æ±‚åˆ°è¾¾æœåŠ¡æä¾›è€…çš„ Filter æ—¶å°±é©¬ä¸Šå»è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè®¾ç½®åˆ° <code>SecurityContext</code> ä¸­ï¼Œè·å–çš„ç”¨æˆ·ä¿¡æ¯å¯¹æœåŠ¡æä¾›è€…çš„æ¥å£æ¥è¯´å¹¶ä¸ä¸€å®šæ˜¯æœ‰ç”¨çš„ï¼ˆå¯èƒ½å¤§éƒ¨åˆ†æ¥å£çš„ä¸šåŠ¡é€»è¾‘æ˜¯ä¸éœ€è¦ç”¨æˆ·ä¿¡æ¯çš„ï¼‰ï¼Œé‚£ä¹ˆè¿™å°±ä¼šé€ æˆå¤§é‡çš„èµ„æºæµªè´¹ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤äº†è§£å†³å¦‚ä½•ä½¿ç”¨ Filter ä¼ é€’ token ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å¦‚ä½•é€šè¿‡ token é‡æ–°è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</li><li>å¦‚ä½•å®ç°æœåŠ¡æä¾›è€…åœ¨éœ€è¦çš„æ—¶å€™æ‰çœŸæ­£å»è·å–ç”¨æˆ·ä¿¡æ¯</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤<a href="#å®ç°æ­¥éª¤" class="hash-link" aria-label="å®ç°æ­¥éª¤çš„ç›´æ¥é“¾æ¥" title="å®ç°æ­¥éª¤çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä¼ é€’-token">ä¼ é€’ token<a href="#ä¼ é€’-token" class="hash-link" aria-label="ä¼ é€’ tokençš„ç›´æ¥é“¾æ¥" title="ä¼ é€’ tokençš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ Dubbo ä¸­å¦‚ä½•è‡ªå®šä¹‰ Filterï¼š<a href="https://dubbo.apache.org/zh/docs3-v2/java-sdk/reference-manual/spi/description/filter/" target="_blank" rel="noopener noreferrer">è°ƒç”¨æ‹¦æˆªæ‰©å±•</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ›å»ºé…ç½®æ–‡ä»¶">åˆ›å»ºé…ç½®æ–‡ä»¶<a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="hash-link" aria-label="åˆ›å»ºé…ç½®æ–‡ä»¶çš„ç›´æ¥é“¾æ¥" title="åˆ›å»ºé…ç½®æ–‡ä»¶çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>åœ¨æ–‡ä»¶å¤¹ <code>src/main/java/resources/META-INF/dubbo</code> ä¸‹åˆ›å»ºæ–‡ä»¶åä¸º <code>org.apache.dubbo.rpc.Filter</code> çš„çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">token-value-consumer=com.gitee.quiet.service.dubbo.filter.consumer.AccessTokenValueFilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">token-value-provider=com.gitee.quiet.service.dubbo.filter.provider.AccessTokenValueFilter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æ³¨å†Œè¿™ä¸¤ä¸ª-filter">æ³¨å†Œè¿™ä¸¤ä¸ª Filter<a href="#æ³¨å†Œè¿™ä¸¤ä¸ª-filter" class="hash-link" aria-label="æ³¨å†Œè¿™ä¸¤ä¸ª Filterçš„ç›´æ¥é“¾æ¥" title="æ³¨å†Œè¿™ä¸¤ä¸ª Filterçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">dubbo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">consumer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">filter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">filter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">provider</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="å®šä¹‰æœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…çš„-filter">å®šä¹‰æœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…çš„ Filter<a href="#å®šä¹‰æœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…çš„-filter" class="hash-link" aria-label="å®šä¹‰æœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…çš„ Filterçš„ç›´æ¥é“¾æ¥" title="å®šä¹‰æœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…çš„ Filterçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><img loading="lazy" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f9ce34befa54ff19888e26f671ce15a~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" width="50%" class="img_ev3q"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="åœ¨æœåŠ¡æ¶ˆè´¹è€…å‘èµ·è°ƒç”¨çš„æ—¶å€™è·å–-requset-ä¸­çš„-token-å€¼">åœ¨æœåŠ¡æ¶ˆè´¹è€…å‘èµ·è°ƒç”¨çš„æ—¶å€™è·å– requset ä¸­çš„ token å€¼<a href="#åœ¨æœåŠ¡æ¶ˆè´¹è€…å‘èµ·è°ƒç”¨çš„æ—¶å€™è·å–-requset-ä¸­çš„-token-å€¼" class="hash-link" aria-label="åœ¨æœåŠ¡æ¶ˆè´¹è€…å‘èµ·è°ƒç”¨çš„æ—¶å€™è·å– requset ä¸­çš„ token å€¼çš„ç›´æ¥é“¾æ¥" title="åœ¨æœåŠ¡æ¶ˆè´¹è€…å‘èµ·è°ƒç”¨çš„æ—¶å€™è·å– requset ä¸­çš„ token å€¼çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">RequestAttributes</span><span class="token plain"> requestAttributes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">RequestContextHolder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRequestAttributes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">String</span><span class="token plain"> tokenValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> requestAttributes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™ä¸ª key åœ¨ä¸Šç¯‡æœ‰æåˆ°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAttribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">OAuth2AuthenticationDetails</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ACCESS_TOKEN_VALUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿™ä¸ªåœ°æ–¹ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæ˜¯æœåŠ¡ <code>A</code> è°ƒç”¨æœåŠ¡ <code>B</code>ï¼ŒæœåŠ¡ <code>B</code> è°ƒç”¨æœåŠ¡ <code>C</code>ï¼Œè¿™æ—¶å€™æœåŠ¡ <code>B</code> æ˜¯æœåŠ¡æ¶ˆè´¹è€…ï¼Œè·å–çš„ <code>requestAttributes</code> æ˜¯ <code>null</code>ï¼Œè¿™æ—¶å°±æ— æ³•è·å– token äº†ã€‚</p><p>åˆ†æå¹¶è§£å†³ï¼šæœåŠ¡ <code>B</code> å…¶å®æ˜¯æœ‰ token çš„ï¼Œåªæ˜¯åœ¨è°ƒç”¨æœåŠ¡ <code>C</code> çš„æ—¶å€™æ— æ³•åœ¨ Filter å¤„è·å–è€Œå·²ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å€ŸåŠ© ThreadLocalï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">ThreadLocal</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">USER_TOKEN</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ThreadLocal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">withInitial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="é€šè¿‡-token-è·å–ç”¨æˆ·ä¿¡æ¯">é€šè¿‡ token è·å–ç”¨æˆ·ä¿¡æ¯<a href="#é€šè¿‡-token-è·å–ç”¨æˆ·ä¿¡æ¯" class="hash-link" aria-label="é€šè¿‡ token è·å–ç”¨æˆ·ä¿¡æ¯çš„ç›´æ¥é“¾æ¥" title="é€šè¿‡ token è·å–ç”¨æˆ·ä¿¡æ¯çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ä¸Šç¯‡ä¸­æˆ‘ä»¬çŸ¥é“å¯ä»¥ä½¿ç”¨ token åœ¨ <code>tokenStore</code> ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œ<code>tokenStore</code> æ˜¯æˆ‘ä»¬æ³¨å…¥çš„ä¸€ä¸ª Beanï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä» Spring å®¹å™¨ä¸­è·å–è¿™ä¸ª Beanï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">TokenStore</span><span class="token plain"> tokenStore </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SpringUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TokenStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">OAuth2Authentication</span><span class="token plain"> authentication </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tokenStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">readAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æœåŠ¡æä¾›è€…å¦‚ä½•åœ¨éœ€è¦ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™æ‰å»è·å–">æœåŠ¡æä¾›è€…å¦‚ä½•åœ¨éœ€è¦ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™æ‰å»è·å–<a href="#æœåŠ¡æä¾›è€…å¦‚ä½•åœ¨éœ€è¦ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™æ‰å»è·å–" class="hash-link" aria-label="æœåŠ¡æä¾›è€…å¦‚ä½•åœ¨éœ€è¦ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™æ‰å»è·å–çš„ç›´æ¥é“¾æ¥" title="æœåŠ¡æä¾›è€…å¦‚ä½•åœ¨éœ€è¦ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™æ‰å»è·å–çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸ºäº†ä¸å½±å“ web è¯·æ±‚è·å–ç”¨æˆ·ä¿¡æ¯çš„æ–¹å¼ï¼Œåœ¨ä½¿ç”¨ Dubbo è°ƒç”¨çš„æ—¶å€™ï¼ŒæœåŠ¡æä¾›è€…å°½å¯èƒ½è€ƒè™‘é€šè¿‡ä¸ web è¯·æ±‚è·å–ç”¨æˆ·ä¿¡æ¯ç›¸åŒçš„æ–¹å¼è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ <code>SecurityContextHolder.getContext().getAuthentication()</code> æ–¹æ³•è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœå®åœ¨æ— æ³•å®ç°ï¼Œå†è€ƒè™‘è‡ªå®šä¹‰ä¸€ç§èƒ½æ»¡è¶³è¿™ä¸¤ç§æƒ…å†µä¸‹éƒ½èƒ½è·å–ç”¨æˆ·ä¿¡æ¯çš„æ–¹å¼ï¼ˆä¼˜é›…æ°¸ä¸è¿‡æ—¶ï½ï¼‰ã€‚</p><img loading="lazy" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e661e4ff3ab454fa433ade92cdccd57~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" width="30%" class="img_ev3q"><p>åœ¨ä¸Šé¢æˆ‘ä»¬åˆ†æäº† <code>SecurityContextHolder</code>ï¼Œåœ¨è¿™ä¸ªç±»é‡Œé¢æä¾›äº† <code>setContext</code> æ–¹æ³•è®¾ç½® <code>SecurityContext</code>ï¼Œå†çœ‹ä¸‹ <code>org.springframework.security.core.context.SecurityContext</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰å®ç°ç±»ï¼Œåœ¨è‡ªå®šä¹‰çš„å®ç°ç±»ä¸­ï¼Œåœ¨è°ƒç”¨ <code>getAuthentication</code> çš„æ—¶å€™æ‰å»è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå†å°†è¿™ä¸ªè‡ªå®šä¹‰ç±»çš„å®ä¾‹ä½œä¸ºå½¢å‚è°ƒç”¨ <code>setContext</code>ï¼Œå°±å¯ä»¥å®ç°æœåŠ¡æä¾›è€…åœ¨éœ€è¦ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™æ‰å»è·å–ç”¨æˆ·ä¿¡æ¯ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">QuietSecurityContext</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">SecurityContext</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> tokenValue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">SecurityContext</span><span class="token plain"> securityContext </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SecurityContextHolder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">QuietSecurityContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token annotation punctuation" style="color:#393A34">@NotBlank</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> tokenValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tokenValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tokenValue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Authentication</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">securityContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> securityContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TokenStore</span><span class="token plain"> tokenStore </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SpringUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TokenStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">OAuth2Authentication</span><span class="token plain"> authentication </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tokenStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">readAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">authentication</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> securityContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Authentication</span><span class="token plain"> authentication</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    securityContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">authentication</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿™é‡Œç”¨åˆ°äº†è®¾è®¡æ¨¡å¼ä¸­çš„è£…é¥°å™¨æ¨¡å¼ï¼Œæ‰€ä»¥ä¸èƒ½è¯´è®¾è®¡æ¨¡å¼åœ¨å·¥ä½œä¸­æ²¡ç”¨ï¼Œåªæ˜¯æ²¡é‡åˆ°ç‰¹å®šçš„åœºæ™¯ï¼</p><h1>Filter å®ç°</h1><p><code>com.gitee.quiet.service.dubbo.filter.consumer.AccessTokenValueFilter</code></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Activate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">CommonConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">CONSUMER</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">AccessTokenValueFilter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">Filter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Invoker</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> invoker</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Invocation</span><span class="token plain"> invocation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">RpcException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">RequestAttributes</span><span class="token plain"> requestAttributes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">RequestContextHolder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRequestAttributes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> tokenValue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requestAttributes </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tokenValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> requestAttributes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAttribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">OAuth2AuthenticationDetails</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ACCESS_TOKEN_VALUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tokenValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">DubboThreadLocal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">USER_TOKEN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StringUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isNotBlank</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      invocation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setAttachment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">OAuth2AuthenticationDetails</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ACCESS_TOKEN_VALUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tokenValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> invoker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">invocation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>com.gitee.quiet.service.dubbo.filter.provider.AccessTokenValueFilter</code></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Activate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">CommonConstants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PROVIDER</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">AccessTokenValueFilter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">Filter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Invoker</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> invoker</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Invocation</span><span class="token plain"> invocation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">RpcException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> tokenValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> invocation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAttachment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">OAuth2AuthenticationDetails</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ACCESS_TOKEN_VALUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StringUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isNotBlank</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">DubboThreadLocal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">USER_TOKEN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">SecurityContextHolder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">QuietSecurityContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> invoker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">invocation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StringUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isNotBlank</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SecurityContextHolder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clearContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">DubboThreadLocal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">USER_TOKEN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ›´è¯¦ç»†çš„ä»£ç å¯ä»¥çœ‹ <a href="https://github.com/lin-mt/quiet" target="_blank" rel="noopener noreferrer">Quiet</a> é¡¹ç›®ä¸­çš„
<code>quiet-spring-boot-starters/quiet-service-spring-boot-starter/src/main/java/com/gitee/quiet/service/dubbo/filter</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ç»“è¯­">ç»“è¯­<a href="#ç»“è¯­" class="hash-link" aria-label="ç»“è¯­çš„ç›´æ¥é“¾æ¥" title="ç»“è¯­çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>è‡³æ­¤ï¼ŒDubbo + Spring Security Oauth2 è§£å†³æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·çš„æ–¹æ¡ˆè¿˜ç®—ä¼˜é›…å§</p><img loading="lazy" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/804aa75e43c744e5adc8837029fced72~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" width="30%" class="img_ev3q"></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/wiki/docs/tags/dubbo">Dubbo</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/wiki/docs/tags/spring-security">Spring Security</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/wiki/docs/tags/spring-security-oauth-2">Spring Security Oauth2</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lin-mt/wiki/tree/main/docs/solution/quiet/è§£å†³åœ¨ Dubbo ä¸­æœåŠ¡æä¾›è€…æ— æ³•è·å–å½“å‰ç”¨æˆ·.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡æ¡£åˆ†é¡µå¯¼èˆª"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#é—®é¢˜èµ·æº" class="table-of-contents__link toc-highlight">é—®é¢˜èµ·æº</a></li><li><a href="#é—®é¢˜åˆ†æ" class="table-of-contents__link toc-highlight">é—®é¢˜åˆ†æ</a><ul><li><a href="#è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹" class="table-of-contents__link toc-highlight">è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹</a></li><li><a href="#securitycontext-çš„-authentication-æ˜¯ä»å“ªæ¥çš„" class="table-of-contents__link toc-highlight"><code>SecurityContext</code> çš„ <code>authentication</code> æ˜¯ä»å“ªæ¥çš„</a></li></ul></li><li><a href="#è§£å†³æ–¹æ¡ˆ" class="table-of-contents__link toc-highlight">è§£å†³æ–¹æ¡ˆ</a><ul><li><a href="#æ–¹æ¡ˆä¸€ä¼ é€’ç”¨æˆ·ä¿¡æ¯" class="table-of-contents__link toc-highlight">æ–¹æ¡ˆä¸€ï¼šä¼ é€’ç”¨æˆ·ä¿¡æ¯</a></li><li><a href="#æ–¹æ¡ˆäºŒè‡ªå·±å®šä¹‰ä¸€ä¸ª-keyå°†ç”¨æˆ·ä¿¡æ¯å­˜åˆ°-redis" class="table-of-contents__link toc-highlight">æ–¹æ¡ˆäºŒï¼šè‡ªå·±å®šä¹‰ä¸€ä¸ª keyï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜åˆ° Redis</a></li><li><a href="#æ–¹æ¡ˆä¸‰ç›´æ¥ä½¿ç”¨-token" class="table-of-contents__link toc-highlight">æ–¹æ¡ˆä¸‰ï¼šç›´æ¥ä½¿ç”¨ token</a></li></ul></li><li><a href="#å®ç°æ­¥éª¤" class="table-of-contents__link toc-highlight">å®ç°æ­¥éª¤</a><ul><li><a href="#ä¼ é€’-token" class="table-of-contents__link toc-highlight">ä¼ é€’ token</a></li><li><a href="#é€šè¿‡-token-è·å–ç”¨æˆ·ä¿¡æ¯" class="table-of-contents__link toc-highlight">é€šè¿‡ token è·å–ç”¨æˆ·ä¿¡æ¯</a></li><li><a href="#æœåŠ¡æä¾›è€…å¦‚ä½•åœ¨éœ€è¦ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™æ‰å»è·å–" class="table-of-contents__link toc-highlight">æœåŠ¡æä¾›è€…å¦‚ä½•åœ¨éœ€è¦ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™æ‰å»è·å–</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 lin-mt, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/wiki/assets/js/runtime~main.af64cee5.js"></script>
<script src="/wiki/assets/js/main.6560775e.js"></script>
</body>
</html>